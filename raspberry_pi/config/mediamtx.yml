# MediaMTX Configuration for Beeper Keeper v2.0
# Optimized for HLS streaming with both cameras at native resolutions

# API
api: yes
apiAddress: :9997

# WebRTC - Ultra low latency streaming (0.5-2 seconds)
webrtc: yes
webrtcAddress: :8889
webrtcICEServers2: []

# HLS - Balanced for reliability and moderate latency
# v2.1 FIX (Nov 26, 2025): Reduced drift between streams
# - Shorter segments (2s) for tighter sync
# - fMP4 variant for better audio/video sync (vs mpegts)
# - Segment count 4 = ~8s buffer (was 24s with 6x4s)
hls: yes
hlsAddress: :8888
hlsAlwaysRemux: yes
hlsVariant: fmp4
hlsSegmentCount: 4
hlsSegmentDuration: 2s
hlsPartDuration: 500ms
hlsSegmentMaxSize: 50M

# RTSP backend
rtspAddress: :8554
protocols: [tcp]
encryption: "no"

# Performance tuning
readTimeout: 20s
writeTimeout: 20s

# Camera streams
paths:
  # CSI Camera (OV5647 IR) - 1920x1080 @ 30fps with hardware H.264
  csi_camera:
    runOnInit: /opt/beeperKeeper/config/start_csi_camera.sh
    runOnInitRestart: yes

  # USB Webcam (eMeet C980 Pro 4K) - 800x600 @ 15fps with H.264 + AAC audio
  usb_camera:
    runOnInit: /opt/beeperKeeper/config/start_usb_camera.sh
    runOnInitRestart: yes
