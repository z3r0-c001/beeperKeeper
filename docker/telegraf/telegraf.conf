# Telegraf Configuration for Beeper Keeper
# Collects MQTT sensor data and sends to InfluxDB

[agent]
  interval = "10s"
  round_interval = true
  metric_batch_size = 1000
  metric_buffer_limit = 10000
  collection_jitter = "0s"
  flush_interval = "10s"
  flush_jitter = "0s"
  precision = "0s"
  hostname = "beeper_telegraf"
  omit_hostname = false

# InfluxDB v2 Output
[[outputs.influxdb_v2]]
  urls = ["http://influxdb:8086"]
  token = "beeper-admin-token-change-this-in-production"
  organization = "beeperkeeper"
  bucket = "sensors"

# MQTT Consumer - BME680 Sensor Data (including air quality metrics)
[[inputs.mqtt_consumer]]
  servers = ["tcp://mosquitto:1883"]
  topics = [
    "beeper/sensors/bme680/+",
    "beeper/sensors/cpu/+",
    "beeper/system/+",
    "beeper/sensors/camera/+",
    "beeper/camera/+/+"
  ]
  data_format = "json"
  json_time_key = "timestamp"
  json_time_format = "unix"
  tag_keys = ["sensor_type", "location"]
  # Note: Now includes IAQ, CO2 equivalent, and compensated gas resistance topics

# MQTT Consumer - Camera Metadata
[[inputs.mqtt_consumer]]
  servers = ["tcp://mosquitto:1883"]
  topics = [
    "beeper/camera/csi/metadata",
    "beeper/camera/usb/metadata"
  ]
  data_format = "json"
  json_time_key = "timestamp"
  json_time_format = "unix"
  tag_keys = ["camera"]
